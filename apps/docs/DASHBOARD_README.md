# üìä Sistema Dashboard Multi-Tenant

Este documento descreve o sistema completo do dashboard multi-tenant do admin app, incluindo middleware de prote√ß√£o, isolamento de dados e interface de usu√°rio.

## üìã √çndice

- [Vis√£o Geral](#-vis√£o-geral)
- [Middleware de Prote√ß√£o](#-middleware-de-prote√ß√£o)
- [Dashboard Interface](#-dashboard-interface)
- [Sistema de Logout](#-sistema-de-logout)
- [Isolamento Multi-Tenant](#-isolamento-multi-tenant)
- [Funcionalidades](#-funcionalidades)
- [Estrutura de Arquivos](#-estrutura-de-arquivos)
- [Como Usar](#-como-usar)
- [Configura√ß√£o](#-configura√ß√£o)

## üéØ Vis√£o Geral

O sistema de dashboard oferece uma interface segura e isolada para visualiza√ß√£o de dados do usu√°rio logado, com prote√ß√£o autom√°tica de rotas e isolamento completo multi-tenant.

### Principais Caracter√≠sticas

- ‚úÖ **Prote√ß√£o Autom√°tica**: Middleware intercepta todas as rotas protegidas
- ‚úÖ **Isolamento Total**: Dados completamente separados por tenant
- ‚úÖ **Interface Rica**: Dashboard com informa√ß√µes completas do usu√°rio
- ‚úÖ **Sistema de Logout**: Bot√£o seguro com confirma√ß√£o e feedback visual
- ‚úÖ **Role-Based Access**: Controle granular baseado em permiss√µes
- ‚úÖ **Redirecionamentos Inteligentes**: Navega√ß√£o autom√°tica baseada no estado
- ‚úÖ **Seguran√ßa JWT**: Valida√ß√£o robusta de tokens

## üõ° Middleware de Prote√ß√£o

### `src/middleware.ts`

O middleware atua como primeira linha de defesa, interceptando todas as requisi√ß√µes:

```typescript
export async function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  const authRoutes = ['/login', '/register'];
  const protectedRoutes = ['/dashboard', '/profile', '/settings', '/admin'];

  const token = request.cookies.get('auth-token')?.value;
  const user = token ? await verifyToken(token) : null;

  // L√≥gica de prote√ß√£o e redirecionamento
}
```

### Funcionalidades do Middleware

#### 1. **Valida√ß√£o JWT Robusta**
```typescript
async function verifyToken(token: string): Promise<JwtPayload | null> {
  try {
    const { payload } = await jwtVerify(token, JWT_SECRET);

    // Valida√ß√£o de propriedades obrigat√≥rias
    if (
      typeof payload.userId === 'string' &&
      typeof payload.email === 'string' &&
      typeof payload.tenantId === 'string' &&
      typeof payload.role === 'string'
    ) {
      return {
        userId: payload.userId,
        email: payload.email,
        tenantId: payload.tenantId,
        role: payload.role,
        tenant: payload.tenant
      };
    }

    return null;
  } catch {
    return null;
  }
}
```

#### 2. **Prote√ß√£o de Rotas por Tipo**

```typescript
// Rotas de autentica√ß√£o - redireciona se j√° logado
const authRoutes = ['/login', '/register'];

// Rotas protegidas - requer login
const protectedRoutes = ['/dashboard', '/profile', '/settings', '/admin'];
```

#### 3. **Controle de Acesso por Role**

```typescript
// Apenas ADMIN pode acessar /admin
if (pathname.startsWith('/admin') && user.role !== 'ADMIN') {
  return NextResponse.redirect(new URL('/dashboard', request.url));
}

// Apenas ADMIN e MANAGER podem acessar /settings
if (pathname.startsWith('/settings') && !['ADMIN', 'MANAGER'].includes(user.role)) {
  return NextResponse.redirect(new URL('/dashboard', request.url));
}
```

#### 4. **Headers de Contexto**

```typescript
// Injeta informa√ß√µes do usu√°rio nos headers para uso posterior
const response = NextResponse.next();
response.headers.set('x-user-id', user.userId);
response.headers.set('x-tenant-id', user.tenantId);
response.headers.set('x-user-role', user.role);
```

#### 5. **Configura√ß√£o de Rotas**

```typescript
export const config = {
  matcher: [
    '/((?!api|_next/static|_next/image|favicon.ico|public).*)',
  ],
};
```

## üìä Dashboard Interface

### `src/app/(root)/(application)/dashboard/page.tsx`

Interface completa e responsiva para visualiza√ß√£o de dados do usu√°rio.

#### Componentes Principais

##### 1. **Header com Papel do Usu√°rio**
```tsx
<div className="flex items-center justify-between">
  <div>
    <h1 className="text-2xl font-bold text-gray-900">Dashboard</h1>
    <p className="text-gray-500 mt-1">
      Bem-vindo ao painel de controle, {user.name}!
    </p>
  </div>
  <Badge variant="outline" className={`px-3 py-1 ${getRoleColor(user.role)}`}>
    {user.role}
  </Badge>
</div>
```

##### 2. **Cards de Informa√ß√£o**

**Dados Pessoais**
- Nome completo
- Email
- ID do usu√°rio (UUID)

**Tenant/Empresa**
- Nome da empresa
- Slug do tenant
- ID do tenant

**Permiss√µes e Status**
- Role com descri√ß√£o colorida
- Status ativo/inativo
- Descri√ß√£o das permiss√µes

##### 3. **Detalhes da Conta**
```tsx
<Card>
  <CardHeader>
    <CardTitle className="text-lg">Detalhes da Conta</CardTitle>
    <CardDescription>
      Informa√ß√µes detalhadas sobre sua conta e acesso
    </CardDescription>
  </CardHeader>
  <CardContent>
    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
      {/* Datas de cria√ß√£o e atualiza√ß√£o */}
      {/* Informa√ß√µes de seguran√ßa */}
    </div>
  </CardContent>
</Card>
```

##### 4. **Avisos de Isolamento**
```tsx
<Card className="border-yellow-200 bg-yellow-50">
  <CardHeader>
    <CardTitle className="text-lg text-yellow-800">
      üõ°Ô∏è Isolamento de Dados
    </CardTitle>
  </CardHeader>
  <CardContent>
    <div className="text-sm text-yellow-700 space-y-2">
      <p>
        <strong>Multi-tenancy ativo:</strong> Todos os seus dados est√£o
        completamente isolados do tenant {user.tenantId}.
      </p>
      {/* Mais informa√ß√µes sobre isolamento */}
    </div>
  </CardContent>
</Card>
```

#### Fun√ß√µes Utilit√°rias

##### 1. **Cores por Role**
```tsx
const getRoleColor = (role: string) => {
  switch (role) {
    case "ADMIN":
      return "bg-red-100 text-red-800 border-red-200";
    case "MANAGER":
      return "bg-blue-100 text-blue-800 border-blue-200";
    case "AGENT":
      return "bg-green-100 text-green-800 border-green-200";
    case "VIEWER":
      return "bg-gray-100 text-gray-800 border-gray-200";
    default:
      return "bg-gray-100 text-gray-800 border-gray-200";
  }
};
```

##### 2. **Descri√ß√µes de Permiss√£o**
```tsx
const getRoleDescription = (role: string) => {
  switch (role) {
    case "ADMIN":
      return "Acesso completo ao sistema";
    case "MANAGER":
      return "Gerenciamento de equipes e vendas";
    case "AGENT":
      return "Vendas e atendimento a clientes";
    case "VIEWER":
      return "Apenas visualiza√ß√£o de dados";
    default:
      return "Usu√°rio padr√£o";
  }
};
```

## üè¢ Isolamento Multi-Tenant

### Como Funciona

1. **Valida√ß√£o no Middleware**: Todo acesso valida se o token cont√©m `tenantId`
2. **Headers de Contexto**: Middleware injeta `x-tenant-id` em todas as requisi√ß√µes
3. **Dados Isolados**: Dashboard s√≥ exibe dados do pr√≥prio tenant
4. **Valida√ß√£o Cont√≠nua**: Hooks verificam `belongsToTenant()` constantemente

### Garantias de Seguran√ßa

```tsx
// No Hook useAuth
const belongsToTenant = (tenantId: string): boolean => {
  return user?.tenantId === tenantId;
};

// Verifica√ß√£o autom√°tica no dashboard
if (!isAuthenticated || !user) {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="text-center">
        <h2 className="text-xl font-semibold text-gray-700">Acesso Negado</h2>
        <p className="text-gray-500 mt-2">Fa√ßa login para acessar o dashboard</p>
      </div>
    </div>
  );
}
```

### Fluxo de Isolamento

```mermaid
graph TD
    A[Usu√°rio acessa /dashboard] --> B[Middleware verifica token]
    B --> C{Token v√°lido?}
    C -->|N√£o| D[Redireciona para /login]
    C -->|Sim| E[Extrai tenantId do JWT]
    E --> F[Injeta x-tenant-id nos headers]
    F --> G[Dashboard carrega]
    G --> H[useAuth busca perfil]
    H --> I{tenantId coincide?}
    I -->|N√£o| J[Remove token + logout]
    I -->|Sim| K[Exibe dados isolados]
    K --> L[Avisos de isolamento vis√≠veis]
```

## üö™ Sistema de Logout

### Funcionalidades Completas

O sistema de logout oferece uma experi√™ncia segura e intuitiva para encerrar a sess√£o do usu√°rio:

#### 1. **Bot√£o de Logout**
```tsx
<Button
  variant="outline"
  size="sm"
  onClick={handleLogout}
  className="flex items-center gap-2 text-red-600 border-red-200 hover:bg-red-50 hover:border-red-300"
>
  <LogOut className="h-4 w-4" />
  Logout
</Button>
```

**Caracter√≠sticas:**
- ‚úÖ **Posicionamento**: Localizado no header do dashboard ao lado do badge de role
- ‚úÖ **Visual**: Cor vermelha indicando a√ß√£o destrutiva
- ‚úÖ **√çcone**: LogOut do Lucide React para clareza visual
- ‚úÖ **Hover**: Efeito visual ao passar o mouse

#### 2. **Modal de Confirma√ß√£o**
```tsx
{showLogoutConfirm && (
  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div className="bg-white rounded-lg p-6 max-w-sm mx-4">
      <div className="flex items-center gap-3 mb-4">
        <LogOut className="h-6 w-6 text-red-600" />
        <div>
          <h3 className="text-lg font-medium text-gray-900">
            Confirmar Logout
          </h3>
          <p className="text-sm text-gray-500 mt-1">
            Tem certeza que deseja sair da sua conta?
          </p>
        </div>
      </div>

      <div className="flex gap-3 justify-end">
        <Button variant="outline" onClick={cancelLogout}>
          Cancelar
        </Button>
        <Button onClick={confirmLogout} disabled={isLoggingOut}>
          {isLoggingOut ? "Saindo..." : "Sair"}
        </Button>
      </div>
    </div>
  </div>
)}
```

**Caracter√≠sticas:**
- ‚úÖ **Overlay**: Fundo semitransparente cobrindo toda a tela
- ‚úÖ **Modal Centralizado**: Design limpo e focado
- ‚úÖ **Confirma√ß√£o**: Pergunta clara sobre a inten√ß√£o do usu√°rio
- ‚úÖ **Dois Bot√µes**: Cancelar (seguro) e Sair (destrutivo)
- ‚úÖ **Z-Index Alto**: Fica acima de outros elementos

#### 3. **Estados de Loading**
```tsx
const [isLoggingOut, setIsLoggingOut] = useState(false);

const confirmLogout = () => {
  setIsLoggingOut(true);

  setTimeout(() => {
    logout();
    setShowLogoutConfirm(false);
    setIsLoggingOut(false);
  }, 500);
};
```

**Feedback Visual:**
- ‚úÖ **Spinner**: Anima√ß√£o de loading durante o processo
- ‚úÖ **Texto Din√¢mico**: "Sair" ‚Üí "Saindo..."
- ‚úÖ **Bot√£o Desabilitado**: Previne cliques m√∫ltiplos
- ‚úÖ **Delay Intencional**: 500ms para mostrar o feedback

#### 4. **L√≥gica de Logout**
```tsx
// No useAuth hook
const logout = () => {
  cookieUtils.removeToken();     // Remove token do cookie
  queryClient.clear();           // Limpa cache do React Query
  router.push("/login");         // Redireciona para login
};
```

**Processo Seguro:**
1. **Remove Token**: Apaga o cookie `auth-token`
2. **Limpa Cache**: Remove todos os dados cached do React Query
3. **Redireciona**: Vai para a p√°gina de login
4. **Middleware Ativo**: Automaticamente bloqueia acesso √†s rotas protegidas

### Fluxo de Logout Completo

```mermaid
graph TD
    A[Usu√°rio clica "Logout"] --> B[Abre modal de confirma√ß√£o]
    B --> C{Usu√°rio escolhe}
    C -->|Cancelar| D[Fecha modal]
    C -->|Sair| E[Mostra loading state]
    E --> F[Remove cookie auth-token]
    F --> G[Limpa React Query cache]
    G --> H[Redireciona para /login]
    H --> I[Middleware bloqueia rotas protegidas]
    I --> J[Usu√°rio na p√°gina de login]
```

### Seguran√ßa do Logout

#### 1. **Limpeza Completa**
- ‚úÖ **Cookie Removal**: Token JWT removido completamente
- ‚úÖ **Memory Cleanup**: Cache do React Query limpo
- ‚úÖ **State Reset**: Estados de autentica√ß√£o zerados

#### 2. **Preven√ß√£o de Acesso**
- ‚úÖ **Middleware Protection**: Rotas protegidas ficam inacess√≠veis
- ‚úÖ **Redirect Autom√°tico**: Tentativas de acesso redirecionam para login
- ‚úÖ **Token Invalidation**: Token n√£o pode mais ser usado

#### 3. **UX Considerations**
- ‚úÖ **Confirma√ß√£o**: Evita logouts acidentais
- ‚úÖ **Feedback Visual**: Usu√°rio v√™ que a a√ß√£o est√° sendo processada
- ‚úÖ **Estado Limpo**: Pr√≥ximo login ser√° fresh sem dados antigos

### Customiza√ß√£o do Logout

#### 1. **Styling do Bot√£o**
```tsx
// Personalizar cores e apar√™ncia
className="flex items-center gap-2 text-red-600 border-red-200 hover:bg-red-50"
```

#### 2. **Posicionamento**
```tsx
// Mover para outro local no dashboard
<div className="flex items-center gap-3">
  <Badge>Role</Badge>
  <LogoutButton /> {/* Aqui ou em qualquer outro lugar */}
</div>
```

#### 3. **Texto e Mensagens**
```tsx
// Customizar mensagens
<h3>Sair da Conta?</h3>
<p>Voc√™ perder√° o acesso at√© fazer login novamente.</p>
```

#### 4. **Delay de Loading**
```tsx
// Ajustar tempo de feedback visual
setTimeout(() => {
  logout();
}, 1000); // 1 segundo em vez de 500ms
```

## ‚ö° Funcionalidades

### 1. **Sistema de Logout Seguro**
```tsx
// Bot√£o com confirma√ß√£o e feedback visual
<Button onClick={handleLogout} className="text-red-600">
  <LogOut className="h-4 w-4" />
  Logout
</Button>

// Modal de confirma√ß√£o
{showLogoutConfirm && <ConfirmationModal />}

// Processo de logout
const logout = () => {
  cookieUtils.removeToken();
  queryClient.clear();
  router.push("/login");
};
```

### 2. **Estados de Loading**
```tsx
if (isLoading) {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    </div>
  );
}
```

### 2. **Sistema de Logout Integrado**
```tsx
// Header com logout button
<div className="flex items-center justify-between">
  <div>
    <h1>Dashboard</h1>
    <p>Bem-vindo, {user.name}!</p>
  </div>
  <div className="flex items-center gap-3">
    <Badge>{user.role}</Badge>
    <LogoutButton />
  </div>
</div>
```

### 3. **Responsividade**
```tsx
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {/* Cards adapt√°veis */}
</div>
```

### 4. **Formata√ß√£o de Datas**
```tsx
{user.createdAt ? new Date(user.createdAt).toLocaleDateString('pt-BR') : 'N/A'}
```

### 5. **Avisos Visuais de Seguran√ßa**
- üîí JWT ativo
- ‚úÖ Dados isolados
- üõ°Ô∏è Multi-tenancy
- üìä Permiss√µes claras
- üö™ Logout seguro com confirma√ß√£o

## üìÅ Estrutura de Arquivos

```
src/
‚îú‚îÄ‚îÄ middleware.ts                    # Prote√ß√£o global de rotas
‚îú‚îÄ‚îÄ app/(root)/(application)/
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx                 # Interface principal do dashboard
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ auth.ts                      # Hooks de autentica√ß√£o
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ auth.service.ts              # Servi√ßos de API
‚îú‚îÄ‚îÄ components/ui/
‚îÇ   ‚îú‚îÄ‚îÄ card.tsx                     # Componentes de card
‚îÇ   ‚îú‚îÄ‚îÄ badge.tsx                    # Badges para roles
‚îÇ   ‚îî‚îÄ‚îÄ ...                          # Outros componentes UI
‚îî‚îÄ‚îÄ lib/
    ‚îú‚îÄ‚îÄ cookies.ts                   # Utilit√°rios para cookies
    ‚îî‚îÄ‚îÄ api.ts                       # Cliente HTTP
```

## üìö Como Usar

### 1. **Acesso B√°sico**

Usu√°rio logado √© automaticamente redirecionado para `/dashboard` ap√≥s login:

```tsx
// No useAuth hook, ap√≥s login bem-sucedido
onSuccess: (data) => {
  cookieUtils.setToken(data.access_token);
  queryClient.invalidateQueries({ queryKey: ["user"] });
  // Middleware redireciona automaticamente para /dashboard
}
```

### 2. **Prote√ß√£o Personalizada**

Para adicionar nova rota protegida:

```tsx
// Em middleware.ts
const protectedRoutes = ['/dashboard', '/profile', '/settings', '/admin', '/nova-rota'];
```

### 3. **Verifica√ß√£o Manual de Tenant**

```tsx
import { useAuth } from "@/hooks/auth";

function MyComponent() {
  const { belongsToTenant, user } = useAuth();

  if (!belongsToTenant("tenant-especifico")) {
    return <div>Acesso negado para este tenant</div>;
  }

  return <div>Dados do tenant: {user.tenant.name}</div>;
}
```

### 4. **Customiza√ß√£o de Roles**

Para adicionar nova role:

```tsx
// Em getRoleColor
case "NOVA_ROLE":
  return "bg-purple-100 text-purple-800 border-purple-200";

// Em getRoleDescription
case "NOVA_ROLE":
  return "Descri√ß√£o da nova role";

// Em hasPermission (auth hook)
const roleHierarchy = {
  ADMIN: 4,
  MANAGER: 3,
  NOVA_ROLE: 2.5,  // Entre Manager e Agent
  AGENT: 2,
  VIEWER: 1,
};
```

## ‚öôÔ∏è Configura√ß√£o

### 1. **Vari√°veis de Ambiente**

```bash
# .env.local
JWT_SECRET=your-super-secret-jwt-key
API_URL=http://localhost:3000
```

### 2. **Configura√ß√£o do Middleware**

```typescript
// middleware.ts
const JWT_SECRET = new TextEncoder().encode(
  process.env.JWT_SECRET || 'your-secret-key'
);
```

### 3. **Rotas Configur√°veis**

```typescript
// Personalize as rotas conforme necess√°rio
const authRoutes = ['/login', '/register', '/forgot-password'];
const protectedRoutes = ['/dashboard', '/profile', '/settings', '/admin', '/reports'];
```

## üîí Considera√ß√µes de Seguran√ßa

### 1. **JWT Validation**
- ‚úÖ Verifica√ß√£o da assinatura
- ‚úÖ Valida√ß√£o de propriedades obrigat√≥rias
- ‚úÖ Tratamento de tokens expirados
- ‚úÖ Remo√ß√£o autom√°tica de tokens inv√°lidos

### 2. **Isolamento Multi-Tenant**
- ‚úÖ Dados completamente separados por tenant
- ‚úÖ Verifica√ß√£o cont√≠nua de `tenantId`
- ‚úÖ Headers de contexto para identifica√ß√£o
- ‚úÖ Avisos visuais de isolamento

### 3. **Role-Based Access**
- ‚úÖ Hierarquia clara de permiss√µes
- ‚úÖ Redirecionamentos baseados em role
- ‚úÖ Valida√ß√£o tanto no cliente quanto servidor
- ‚úÖ Feedback visual de permiss√µes

### 4. **Protection Layers**
- ‚úÖ Middleware (primeira linha)
- ‚úÖ React Query (estado global)
- ‚úÖ Componentes (valida√ß√£o local)
- ‚úÖ API (valida√ß√£o servidor)

## üöÄ Recursos Avan√ßados

### 1. **Headers Contextuais**

O middleware injeta headers √∫teis:

```typescript
// Dispon√≠vel em Server Components e API Routes
headers().get('x-user-id')
headers().get('x-tenant-id')
headers().get('x-user-role')
```

### 2. **Cache Strategy**

```tsx
// React Query com cache otimizado
const { data: user, isLoading } = useQuery<User>({
  queryKey: ["user"],
  queryFn: () => authService.getProfile(),
  staleTime: 5 * 60 * 1000, // 5 minutos
  retry: false
});
```

### 3. **Error Boundaries**

```tsx
// Tratamento de erros autom√°tico
if (!isAuthenticated || !user) {
  return <AccessDeniedComponent />;
}
```

### 4. **Loading States**

```tsx
// Estados de loading granulares
const {
  isLoading,
  isLoadingLogin,
  isLoadingRegister,
  isLoadingProfile
} = useAuth();
```

## üìà Performance

### 1. **Lazy Loading**
- Componentes carregados sob demanda
- Chunks separados por rota
- Images otimizadas

### 2. **Caching**
- React Query cache strategy
- JWT valida√ß√£o cacheada
- Estados persistidos

### 3. **Bundle Optimization**
- Tree shaking autom√°tico
- Dynamic imports
- CSS otimizado

---

**Dashboard multi-tenant robusto, seguro e pronto para produ√ß√£o! üéâ**

## üöÄ Funcionalidades Implementadas

### ‚úÖ **Sistema Completo**
- **Login/Logout seguro** com confirma√ß√£o e feedback visual
- **Dashboard responsivo** com dados do usu√°rio isolados por tenant
- **Middleware de prote√ß√£o** autom√°tica para todas as rotas
- **Role-based access control** com hierarquia de permiss√µes
- **Multi-tenancy robusto** com isolamento completo de dados
- **Interface polida** com componentes UI consistentes

### ‚úÖ **Fluxo de Usu√°rio**
1. **Login** ‚Üí Autentica√ß√£o com credenciais + tenant (opcional)
2. **Dashboard** ‚Üí Visualiza√ß√£o de dados pessoais e do tenant
3. **Navega√ß√£o segura** ‚Üí Middleware protege rotas automaticamente
4. **Logout** ‚Üí Modal de confirma√ß√£o + limpeza completa + redirecionamento

### ‚úÖ **Seguran√ßa**
- **JWT validation** com secrets sincronizados entre API e admin
- **Cookie management** com `auth-token` seguro
- **Token invalidation** completa no logout
- **Route protection** baseada em middleware Next.js
- **Data isolation** rigoroso por tenant

## üîê Sistema de Permiss√µes Granulares

### Hierarquia de Roles

O sistema implementa uma hierarquia rigorosa de permiss√µes baseada em 4 n√≠veis:

```
ADMIN (N√≠vel 4)    ‚Üê Acesso completo
  ‚Üì
MANAGER (N√≠vel 3)  ‚Üê Gerenciamento + operacional
  ‚Üì
AGENT (N√≠vel 2)    ‚Üê Operacional + visualiza√ß√£o
  ‚Üì
VIEWER (N√≠vel 1)   ‚Üê Apenas visualiza√ß√£o
```

### Funcionalidades por Role

#### üî¥ **ADMIN (Administrador)**
- ‚úÖ **Gerenciar usu√°rios** - Criar, editar, desativar contas
- ‚úÖ **Configurar sistema** - Par√¢metros globais e integra√ß√µes
- ‚úÖ **Relat√≥rios completos** - Todos os dados e m√©tricas
- ‚úÖ **Auditoria e logs** - Hist√≥rico completo de atividades
- ‚úÖ **An√°lise financeira** - Dados sens√≠veis e estrat√©gicos
- ‚úÖ **Acesso total** - Todas as funcionalidades do sistema

#### üîµ **MANAGER (Gerente)**
- ‚úÖ **Gerenciar equipes** - Coordenar agentes e atividades
- ‚úÖ **Relat√≥rios gerenciais** - M√©tricas de performance
- ‚úÖ **An√°lise de performance** - KPIs e indicadores
- ‚ùå **Configura√ß√µes avan√ßadas** - Restrito ao ADMIN
- ‚ùå **Auditoria completa** - Restrito ao ADMIN

#### üü¢ **AGENT (Agente)**
- ‚úÖ **Gerenciar leads** - CRUD de prospects e clientes
- ‚úÖ **Relat√≥rios b√°sicos** - Suas m√©tricas pessoais
- ‚úÖ **Configurar perfil** - Dados pessoais e prefer√™ncias
- ‚ùå **Relat√≥rios avan√ßados** - Requer MANAGER ou ADMIN
- ‚ùå **Gerenciar equipes** - Requer MANAGER ou ADMIN

#### üîò **VIEWER (Visualizador)**
- ‚úÖ **Visualizar dados** - Acesso somente leitura
- ‚úÖ **Relat√≥rios b√°sicos** - Dashboards limitados
- ‚ùå **Gerenciar leads** - Requer AGENT ou superior
- ‚ùå **Configura√ß√µes** - Requer AGENT ou superior
- ‚ùå **Relat√≥rios avan√ßados** - Requer MANAGER ou ADMIN

### √Åreas do Sistema por Permiss√£o

#### üìä **√Årea Pessoal**
- **Acesso:** Todos os usu√°rios
- **Conte√∫do:** Dados pessoais, informa√ß√µes do tenant, logout

#### üéØ **√Årea Operacional**
- **Acesso:** AGENT ou superior
- **Conte√∫do:** Gest√£o de leads, tarefas di√°rias, pipeline de vendas

#### üë• **√Årea Gerencial**
- **Acesso:** MANAGER ou superior
- **Conte√∫do:** Gest√£o de equipes, relat√≥rios avan√ßados, an√°lises

#### ‚öôÔ∏è **√Årea Administrativa**
- **Acesso:** Apenas ADMIN
- **Conte√∫do:** Configura√ß√µes do sistema, controle total, auditoria

### Valida√ß√£o de Permiss√µes

O sistema valida permiss√µes em m√∫ltiplas camadas:

```tsx
// 1. Hook de valida√ß√£o
const { hasPermission } = useAuth();

// 2. Middleware de rota
if (!hasPermission("MANAGER")) {
  return redirect("/dashboard");
}

// 3. Componente condicional
{hasPermission("ADMIN") && <AdminPanel />}

// 4. API-level validation
@Roles(Role.ADMIN)
async deleteUser(@Param('id') id: string) {
  // S√≥ ADMIN pode executar
}
```

### Interface Visual de Permiss√µes

O dashboard mostra visualmente o que cada usu√°rio pode fazer:

#### üéØ **Funcionalidades por Permiss√£o**
- Cards verdes ‚úÖ - Funcionalidades permitidas
- Cards vermelhos ‚ùå - Funcionalidades bloqueadas
- Raz√µes espec√≠ficas para cada restri√ß√£o

#### üè¢ **√Åreas do Sistema**
- Se√ß√µes azuis üîì - √Åreas acess√≠veis
- Se√ß√µes cinzas üîí - √Åreas bloqueadas
- Explica√ß√£o clara do motivo da restri√ß√£o

#### üèÜ **Hierarquia Visual**
- Cart√µes coloridos por n√≠vel de permiss√£o
- Indica√ß√£o do n√≠vel atual do usu√°rio
- Explica√ß√£o da heran√ßa de permiss√µes

## üß™ Como Testar

### 1. **Login e Dashboard por Role**

#### **ADMIN** - Acesso Completo
- **empresa-demo**: admin@empresa-demo.com / Demo123!
- **imobiliaria-abc**: admin@imobiliaria-abc.com / Demo123!
- **tech-solutions**: admin@tech-solutions.com / Demo123!

#### **MANAGER** - Gerenciamento
- **empresa-demo**: manager@empresa-demo.com / Demo123!
- **tech-solutions**: manager@tech-solutions.com / Demo123!

#### **AGENT** - Operacional
- **empresa-demo**: agent@empresa-demo.com / Demo123!
- **imobiliaria-abc**: maria@imobiliaria-abc.com / Demo123!
- **imobiliaria-abc**: lucas@imobiliaria-abc.com / Demo123!
- **tech-solutions**: dev.senior@tech-solutions.com / Demo123!
- **tech-solutions**: dev.junior@tech-solutions.com / Demo123!

#### **VIEWER** - Apenas Visualiza√ß√£o
- **empresa-demo**: viewer@empresa-demo.com / Demo123!
- **tech-solutions**: estagiario@tech-solutions.com / Demo123!

### 2. **Testar Permiss√µes por Role**

#### **Teste Completo de Permiss√µes**
1. Fa√ßa login como **ADMIN** (`admin@empresa-demo.com`)
   - Observe: Todas as funcionalidades em verde ‚úÖ
   - Observe: Todas as √°reas do sistema acess√≠veis üîì
   - Observe: Badge "N√≠vel 4" na hierarquia

2. Fa√ßa logout e login como **MANAGER** (`manager@empresa-demo.com`)
   - Observe: Funcionalidades limitadas (sem auditoria/config)
   - Observe: √Årea administrativa bloqueada üîí
   - Observe: Badge "N√≠vel 3" na hierarquia

3. Fa√ßa logout e login como **AGENT** (`agent@empresa-demo.com`)
   - Observe: Menos funcionalidades (sem gest√£o de equipes)
   - Observe: √Årea gerencial bloqueada üîí
   - Observe: Badge "N√≠vel 2" na hierarquia

4. Fa√ßa logout e login como **VIEWER** (`viewer@empresa-demo.com`)
   - Observe: Apenas visualiza√ß√£o de dados
   - Observe: M√∫ltiplas √°reas bloqueadas üîí
   - Observe: Badge "N√≠vel 1" na hierarquia

### 3. **Testar Isolamento Multi-Tenant + Permiss√µes**

#### **Cen√°rio 1: ADMINs de diferentes tenants**
1. Login: `admin@empresa-demo.com` ‚Üí V√™ dados da "Empresa Demo"
2. Logout ‚Üí Login: `admin@imobiliaria-abc.com` ‚Üí V√™ dados da "Imobili√°ria ABC"
3. Logout ‚Üí Login: `admin@tech-solutions.com` ‚Üí V√™ dados da "Tech Solutions Corp"

#### **Cen√°rio 2: Diferentes roles no mesmo tenant**
1. Login: `admin@tech-solutions.com` (ADMIN) ‚Üí Acesso completo
2. Logout ‚Üí Login: `manager@tech-solutions.com` (MANAGER) ‚Üí Acesso limitado
3. Logout ‚Üí Login: `dev.senior@tech-solutions.com` (AGENT) ‚Üí Acesso operacional
4. Logout ‚Üí Login: `estagiario@tech-solutions.com` (VIEWER) ‚Üí Apenas visualiza√ß√£o

#### **Cen√°rio 3: Mesma role em tenants diferentes**
1. Login: `agent@empresa-demo.com` (AGENT na Empresa Demo)
2. Logout ‚Üí Login: `dev.senior@tech-solutions.com` (AGENT na Tech Solutions)
3. Compare: Mesmas permiss√µes, dados diferentes isolados por tenant

### 4. **Testar Logout Seguro**
1. Fa√ßa login com qualquer credencial
2. No dashboard, clique no bot√£o "Logout" (canto superior direito)
3. Confirme no modal que aparecer
4. Observe o redirecionamento autom√°tico para `/login`
5. Tente acessar `/dashboard` diretamente ‚Üí ser√° redirecionado para login

### 5. **Validar Isolamento de Dados**
- **Cada tenant v√™ apenas seus dados**
- **Cada role v√™ apenas as funcionalidades permitidas**
- **Mesmo email em tenants diferentes funciona isoladamente**
- **N√≠vel de permiss√£o claramente indicado no dashboard**

### üìä **Resumo dos Usu√°rios Criados**

#### üè¢ **Empresa Demo** (empresa-demo)
- `admin@empresa-demo.com` - ADMIN üî¥
- `manager@empresa-demo.com` - MANAGER üîµ
- `agent@empresa-demo.com` - AGENT üü¢
- `viewer@empresa-demo.com` - VIEWER üîò
- `inactive@empresa-demo.com` - INACTIVE ‚ùå

#### üè† **Imobili√°ria ABC** (imobiliaria-abc)
- `admin@imobiliaria-abc.com` - ADMIN üî¥
- `maria@imobiliaria-abc.com` - AGENT üü¢
- `lucas@imobiliaria-abc.com` - AGENT üü¢

#### üíª **Tech Solutions Corp** (tech-solutions)
- `admin@tech-solutions.com` - ADMIN üî¥
- `manager@tech-solutions.com` - MANAGER üîµ
- `dev.senior@tech-solutions.com` - AGENT üü¢
- `dev.junior@tech-solutions.com` - AGENT üü¢
- `estagiario@tech-solutions.com` - VIEWER üîò
- `inactive@tech-solutions.com` - INACTIVE ‚ùå

**Todos com senha:** `Demo123!`

**Sistema completo com permiss√µes granulares, isolamento multi-tenant e interface visual das permiss√µes funcionando perfeitamente!** üéâüîê

## üîÑ Fluxo de Assinatura da Plataforma

### Como Funciona na Produ√ß√£o

O sistema ConnectHub √© uma plataforma SaaS (Software as a Service) multi-tenant que permite que diferentes empresas usem o mesmo sistema de forma completamente isolada. Aqui est√° como funcionaria o processo de assinatura:

### 1. **Processo de Assinatura/Onboarding**

#### **Etapa 1: Escolha do Plano**
```
üåü PLANO STARTER (R$ 149/m√™s)
- At√© 5 usu√°rios
- 1.000 leads/m√™s
- Suporte b√°sico
- Funcionalidades core

üíé PLANO PROFESSIONAL (R$ 299/m√™s)
- At√© 20 usu√°rios
- 5.000 leads/m√™s
- Relat√≥rios avan√ßados
- Integra√ß√µes API

üöÄ PLANO ENTERPRISE (R$ 599/m√™s)
- Usu√°rios ilimitados
- Leads ilimitados
- Suporte priorit√°rio
- Customiza√ß√µes avan√ßadas
```

#### **Etapa 2: Cria√ß√£o do Tenant**
Quando uma empresa assina a plataforma:

```typescript
// 1. Empresa preenche formul√°rio de assinatura
const signupData = {
  companyName: "Tech Solutions Corp",
  contactEmail: "admin@tech-solutions.com",
  contactName: "Jo√£o Silva",
  plan: "PROFESSIONAL",
  domain: "tech-solutions" // Subdom√≠nio personalizado
};

// 2. Sistema cria automaticamente:
const tenant = await createTenant({
  name: "Tech Solutions Corp",
  slug: "tech-solutions", // URL: tech-solutions.connecthub.com
  plan: "PROFESSIONAL",
  settings: {
    maxUsers: 20,
    maxLeads: 5000,
    features: ["reports", "integrations"]
  }
});

// 3. Primeiro usu√°rio (ADMIN) √© criado automaticamente
const adminUser = await createUser({
  name: "Jo√£o Silva",
  email: "admin@tech-solutions.com",
  role: "ADMIN",
  tenantId: tenant.id,
  password: generateTempPassword(), // Enviado por email
  isActive: true
});
```

#### **Etapa 3: Configura√ß√£o Inicial**
```typescript
// Email autom√°tico enviado para o administrador
const welcomeEmail = {
  to: "admin@tech-solutions.com",
  subject: "Bem-vindo ao ConnectHub! Sua conta foi criada",
  content: `
    üéâ Parab√©ns! Sua empresa Tech Solutions Corp est√° pronta no ConnectHub.

    üìç Acesse: https://tech-solutions.connecthub.com
    üîë Email: admin@tech-solutions.com
    üîí Senha tempor√°ria: ${tempPassword}

    Pr√≥ximos passos:
    ‚úÖ Fa√ßa login e altere sua senha
    ‚úÖ Configure os dados da empresa
    ‚úÖ Convide sua equipe
    ‚úÖ Comece a usar o sistema
  `
};
```

### 2. **Sistema de Registro de Usu√°rios**

#### **Como Funciona o Convite de Equipe**

```typescript
// ADMIN convida novos usu√°rios
const inviteUser = async (inviteData) => {
  // 1. Validar se ADMIN tem permiss√£o
  if (currentUser.role !== 'ADMIN') {
    throw new Error('Apenas administradores podem convidar usu√°rios');
  }

  // 2. Verificar limite do plano
  const userCount = await getUserCount(currentUser.tenantId);
  if (userCount >= tenant.plan.maxUsers) {
    throw new Error('Limite de usu√°rios do plano atingido');
  }

  // 3. Criar convite
  const invite = await createInvite({
    email: inviteData.email,
    role: inviteData.role,
    tenantId: currentUser.tenantId,
    invitedBy: currentUser.id,
    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 dias
  });

  // 4. Enviar email de convite
  await sendInviteEmail(invite);
};
```

#### **Processo de Aceite do Convite**

```typescript
// Usu√°rio clica no link do email e preenche dados
const acceptInvite = async (token, userData) => {
  // 1. Validar token do convite
  const invite = await validateInviteToken(token);

  // 2. Criar usu√°rio
  const newUser = await createUser({
    name: userData.name,
    email: invite.email,
    password: hashPassword(userData.password),
    role: invite.role,
    tenantId: invite.tenantId,
    isActive: true
  });

  // 3. Marcar convite como aceito
  await markInviteAsAccepted(invite.id);

  // 4. Login autom√°tico
  return generateJWT(newUser);
};
```

### 3. **Fluxo de Primeiro Acesso**

#### **Para o Administrador (Primeiro Login)**
```mermaid
graph TD
    A[Admin recebe email de boas-vindas] --> B[Acessa URL personalizada do tenant]
    B --> C[Faz login com credenciais tempor√°rias]
    C --> D[Sistema for√ßa altera√ß√£o de senha]
    D --> E[Setup inicial: dados da empresa]
    E --> F[Convida equipe via email]
    F --> G[Configura integra√ß√µes opcionais]
    G --> H[Dashboard pronto para uso]
```

#### **Para Usu√°rios Convidados**
```mermaid
graph TD
    A[Recebe email de convite] --> B[Clica no link do convite]
    B --> C[Preenche dados pessoais e senha]
    C --> D[Conta criada automaticamente]
    D --> E[Login autom√°tico]
    E --> F[Onboarding baseado na role]
    F --> G[Dashboard personalizado por permiss√£o]
```

### 4. **Estrutura de URLs na Produ√ß√£o**

#### **Subdom√≠nios Personalizados**
```
https://empresa-demo.connecthub.com      ‚Üí Empresa Demo
https://imobiliaria-abc.connecthub.com   ‚Üí Imobili√°ria ABC
https://tech-solutions.connecthub.com    ‚Üí Tech Solutions Corp
```

#### **Dom√≠nios Pr√≥prios (Enterprise)**
```
https://crm.tech-solutions.com           ‚Üí Aponta para ConnectHub
https://vendas.imobiliaria-abc.com.br    ‚Üí Aponta para ConnectHub
```

### 5. **N√≠veis de Acesso na Produ√ß√£o**

#### **Baseado no Plano Contratado**

```typescript
const planFeatures = {
  STARTER: {
    maxUsers: 5,
    maxLeads: 1000,
    features: ['dashboard', 'leads', 'basic_reports'],
    roles: ['ADMIN', 'AGENT', 'VIEWER']
  },
  PROFESSIONAL: {
    maxUsers: 20,
    maxLeads: 5000,
    features: ['dashboard', 'leads', 'advanced_reports', 'integrations'],
    roles: ['ADMIN', 'MANAGER', 'AGENT', 'VIEWER']
  },
  ENTERPRISE: {
    maxUsers: -1, // Ilimitado
    maxLeads: -1, // Ilimitado
    features: ['all_features', 'custom_integrations', 'white_label'],
    roles: ['ADMIN', 'MANAGER', 'AGENT', 'VIEWER', 'CUSTOM_ROLES']
  }
};
```

#### **Funcionalidades por Plano**

| Funcionalidade | Starter | Professional | Enterprise |
|----------------|---------|--------------|------------|
| Dashboard b√°sico | ‚úÖ | ‚úÖ | ‚úÖ |
| Gest√£o de leads | ‚úÖ | ‚úÖ | ‚úÖ |
| Relat√≥rios b√°sicos | ‚úÖ | ‚úÖ | ‚úÖ |
| Relat√≥rios avan√ßados | ‚ùå | ‚úÖ | ‚úÖ |
| Gest√£o de equipes | ‚ùå | ‚úÖ | ‚úÖ |
| Integra√ß√µes API | ‚ùå | ‚úÖ | ‚úÖ |
| Customiza√ß√µes | ‚ùå | ‚ùå | ‚úÖ |
| White label | ‚ùå | ‚ùå | ‚úÖ |
| Suporte priorit√°rio | ‚ùå | ‚ùå | ‚úÖ |

### 6. **Sistema de Billing e Upgrades**

#### **Controle de Limites**
```typescript
const checkPlanLimits = async (tenantId, action) => {
  const tenant = await getTenant(tenantId);
  const usage = await getUsage(tenantId);

  switch (action) {
    case 'ADD_USER':
      if (usage.users >= tenant.plan.maxUsers) {
        return {
          allowed: false,
          message: 'Limite de usu√°rios atingido. Fa√ßa upgrade do seu plano.',
          upgradeUrl: '/billing/upgrade'
        };
      }
      break;

    case 'ADD_LEAD':
      if (usage.leads >= tenant.plan.maxLeads) {
        return {
          allowed: false,
          message: 'Limite de leads atingido. Fa√ßa upgrade do seu plano.',
          upgradeUrl: '/billing/upgrade'
        };
      }
      break;
  }

  return { allowed: true };
};
```

#### **Processo de Upgrade**
```typescript
const upgradeSubscription = async (tenantId, newPlan) => {
  // 1. Calcular diferen√ßa de pre√ßo
  const currentPlan = await getCurrentPlan(tenantId);
  const priceChange = calculateProration(currentPlan, newPlan);

  // 2. Processar pagamento
  const payment = await processPayment(priceChange);

  // 3. Atualizar plano
  await updateTenantPlan(tenantId, {
    plan: newPlan,
    upgradeDate: new Date(),
    nextBilling: calculateNextBilling(newPlan)
  });

  // 4. Liberar novas funcionalidades
  await unlockPlanFeatures(tenantId, newPlan);
};
```

### 7. **Seguran√ßa Multi-Tenant na Produ√ß√£o**

#### **Isolamento de Dados**
```sql
-- Todas as queries incluem WHERE tenantId
SELECT * FROM leads WHERE tenantId = ? AND userId = ?
SELECT * FROM users WHERE tenantId = ? AND id = ?
SELECT * FROM reports WHERE tenantId = ? AND createdBy = ?
```

#### **Valida√ß√£o de Acesso**
```typescript
// Row-Level Security no PostgreSQL
CREATE POLICY tenant_isolation ON leads
  FOR ALL
  TO authenticated_users
  USING (tenantId = current_setting('app.current_tenant')::uuid);

// Middleware de seguran√ßa
const validateTenantAccess = (req, res, next) => {
  const userTenantId = req.user.tenantId;
  const requestedTenantId = req.params.tenantId || req.body.tenantId;

  if (userTenantId !== requestedTenantId) {
    return res.status(403).json({
      error: 'Acesso negado: tenant n√£o autorizado'
    });
  }

  next();
};
```

### 8. **Monitoramento e Analytics**

#### **M√©tricas por Tenant**
```typescript
const tenantAnalytics = {
  usage: {
    activeUsers: 15,
    leadsCreated: 1250,
    reportsGenerated: 45,
    apiCalls: 8900
  },
  performance: {
    avgResponseTime: '200ms',
    uptime: '99.9%',
    errorRate: '0.1%'
  },
  billing: {
    plan: 'PROFESSIONAL',
    monthlyRevenue: 299,
    nextBillingDate: '2024-02-01',
    status: 'active'
  }
};
```

### 9. **Exemplo de Fluxo Completo**

#### **Cen√°rio Real: Tech Solutions Corp**

```
üìù ASSINATURA
‚Üì
üèóÔ∏è CRIA√á√ÉO DO TENANT
- Nome: Tech Solutions Corp
- Slug: tech-solutions
- Plano: Professional (R$ 299/m√™s)
- URL: https://tech-solutions.connecthub.com

‚Üì
üë§ ADMIN INICIAL
- Nome: Jo√£o Silva
- Email: admin@tech-solutions.com
- Role: ADMIN
- Senha tempor√°ria enviada por email

‚Üì
üîë PRIMEIRO LOGIN
- Login com credenciais tempor√°rias
- Altera√ß√£o obrigat√≥ria de senha
- Setup inicial dos dados da empresa

‚Üì
üë• CONVITE DA EQUIPE
- manager@tech-solutions.com (MANAGER)
- dev.senior@tech-solutions.com (AGENT)
- dev.junior@tech-solutions.com (AGENT)
- estagiario@tech-solutions.com (VIEWER)

‚Üì
‚úÖ SISTEMA OPERACIONAL
- Cada usu√°rio com suas permiss√µes
- Dados isolados por tenant
- Funcionalidades baseadas no plano
- Billing autom√°tico mensal
```

### 10. **Considera√ß√µes T√©cnicas de Produ√ß√£o**

#### **Banco de Dados**
- **Particionamento**: Tabelas particionadas por `tenantId`
- **√çndices**: Otimizados para queries multi-tenant
- **Backup**: Isolado por tenant para restaura√ß√µes espec√≠ficas

#### **Cache e Performance**
- **Redis**: Cache segregado por tenant
- **CDN**: Assets est√°ticos otimizados
- **Load Balancer**: Distribui√ß√£o inteligente por regi√£o

#### **Observabilidade**
- **Logs**: Estruturados com `tenantId` em todos os eventos
- **M√©tricas**: Dashboards separados por tenant
- **Alertas**: Monitoramento proativo por empresa

---

## üéØ Fluxos Implementados

### 1. **P√°gina de Assinatura Completa**

#### **Localiza√ß√£o**: `/signup`
A p√°gina de assinatura simula o processo completo de aquisi√ß√£o de um plano:

**Etapa 1: Sele√ß√£o do Plano**
- Visualiza√ß√£o de 3 planos (Starter, Professional, Enterprise)
- Compara√ß√£o visual de funcionalidades
- Sele√ß√£o interativa com destaque visual
- Plano "Professional" marcado como mais popular

**Etapa 2: Dados da Empresa**
- Formul√°rio com valida√ß√£o completa usando Zod
- Campo de subdom√≠nio com preview da URL final
- Resumo do plano selecionado
- Simula√ß√£o de processamento com loading state

#### **Funcionalidades**:
```typescript
// Valida√ß√£o de dados
const signupSchema = z.object({
  companyName: z.string().min(2, "Nome da empresa deve ter pelo menos 2 caracteres"),
  contactName: z.string().min(2, "Nome deve ter pelo menos 2 caracteres"),
  contactEmail: z.string().email("Email inv√°lido"),
  domain: z.string()
    .min(3, "Dom√≠nio deve ter pelo menos 3 caracteres")
    .regex(/^[a-z0-9-]+$/, "Use apenas letras min√∫sculas, n√∫meros e h√≠fens"),
  plan: z.enum(["STARTER", "PROFESSIONAL", "ENTERPRISE"]),
});

// Simula√ß√£o de processamento
const onSubmit = async (data: SignupData) => {
  setIsSubmitting(true);
  await new Promise(resolve => setTimeout(resolve, 2000));
  router.push(`/signup/success?company=${data.companyName}&domain=${data.domain}`);
};
```

### 2. **P√°gina de Sucesso da Assinatura**

#### **Localiza√ß√£o**: `/signup/success`
P√°gina de confirma√ß√£o ap√≥s conclus√£o da assinatura:

**Funcionalidades**:
- Status da conta criada (simulado)
- Credenciais tempor√°rias geradas
- Bot√£o para copiar credenciais
- URL do tenant personalizada
- Pr√≥ximos passos detalhados
- Link direto para login com dados preenchidos

#### **Experi√™ncia do Usu√°rio**:
```typescript
// Credenciais tempor√°rias simuladas
const tempCredentials = {
  email: `admin@${domain}.com`,
  password: "TempPass123!",
};

// Redirecionamento inteligente para login
const goToLogin = () => {
  router.push(`/login?email=${tempCredentials.email}&tenant=${domain}`);
};
```

### 3. **Login Aprimorado com Par√¢metros**

#### **Funcionalidades Adicionadas**:
- Preenchimento autom√°tico com par√¢metros da URL
- Campo de tenant sempre vis√≠vel
- Aviso de boas-vindas para novos usu√°rios
- Link para p√°gina de assinatura
- Credenciais demo organizadas por tenant

#### **Integra√ß√£o com URL Parameters**:
```typescript
// Preenchimento autom√°tico dos campos
useEffect(() => {
  const emailParam = searchParams.get("email");
  const tenantParam = searchParams.get("tenant");

  if (emailParam) setValue("email", emailParam);
  if (tenantParam) setValue("tenantId", tenantParam);
}, [searchParams, setValue]);
```

### 4. **P√°gina Inicial de Navega√ß√£o**

#### **Localiza√ß√£o**: `/` (redireciona) e `/login` (se√ß√£o inicial)
- Card de login para usu√°rios existentes
- Card de assinatura para novos clientes
- Demonstra√ß√£o das 3 empresas fict√≠cias
- Explica√ß√£o das funcionalidades principais

### 5. **Sistema de Logout Implementado**

#### **Funcionalidades**:
- Bot√£o de logout no header do dashboard
- Modal de confirma√ß√£o com loading state
- Limpeza completa de dados (token + cache)
- Redirecionamento autom√°tico para login
- Preven√ß√£o de logouts acidentais

#### **Implementa√ß√£o**:
```typescript
const handleLogout = () => setShowLogoutConfirm(true);

const confirmLogout = () => {
  setIsLoggingOut(true);
  setTimeout(() => {
    logout(); // Remove token + limpa cache + redireciona
    setShowLogoutConfirm(false);
    setIsLoggingOut(false);
  }, 500);
};
```

### 6. **Middleware Atualizado**

#### **Novas Rotas P√∫blicas**:
```typescript
const authRoutes = ["/login", "/register"];
const publicRoutes = ["/signup", "/signup/success"]; // Nova configura√ß√£o
const protectedRoutes = ["/dashboard", "/profile", "/settings", "/admin"];
```

## üöÄ Fluxo Completo de Usu√°rio

### **Cen√°rio 1: Novo Cliente (Assinatura)**

```
1. Usu√°rio acessa "/" ‚Üí Redirecionado para p√°gina de navega√ß√£o
2. Clica em "Assinar Agora" ‚Üí Vai para /signup
3. Seleciona plano (ex: Professional)
4. Preenche dados da empresa:
   - Nome: "Tech Solutions Corp"
   - Respons√°vel: "Jo√£o Silva"
   - Email: "admin@tech-solutions.com"
   - Dom√≠nio: "tech-solutions"
5. Finaliza assinatura ‚Üí Processamento simulado
6. Redirecionado para /signup/success
7. V√™ credenciais tempor√°rias:
   - Email: admin@tech-solutions.com
   - Senha: TempPass123!
8. Clica "Fazer login agora"
9. Redirecionado para /login?email=admin@tech-solutions.com&tenant=tech-solutions
10. Campos preenchidos automaticamente
11. Login ‚Üí Dashboard personalizado
```

### **Cen√°rio 2: Cliente Existente (Login Direto)**

```
1. Usu√°rio acessa "/" ‚Üí Redirecionado conforme autentica√ß√£o
2. Se n√£o autenticado ‚Üí /login
3. V√™ credenciais demo organizadas por tenant
4. Seleciona usu√°rio (ex: manager@empresa-demo.com)
5. Login ‚Üí Dashboard com permiss√µes espec√≠ficas
6. Pode fazer logout ‚Üí Modal de confirma√ß√£o ‚Üí Login novamente
```

### **Cen√°rio 3: Teste de Diferentes Permiss√µes**

```
1. Login como admin@empresa-demo.com ‚Üí Dashboard com acesso total
2. Logout ‚Üí Modal de confirma√ß√£o ‚Üí Redirecionado para login
3. Login como agent@empresa-demo.com ‚Üí Dashboard com acesso limitado
4. Logout ‚Üí Login como viewer@imobiliaria-abc.com ‚Üí Dashboard apenas visualiza√ß√£o
5. Compara visualmente as diferen√ßas de permiss√£o entre roles
```

## üéØ URLs e Rotas Implementadas

### **Rotas P√∫blicas (Sem Autentica√ß√£o)**
- `/` - P√°gina inicial (redireciona conforme autentica√ß√£o)
- `/login` - Login com credenciais demo + link para assinatura
- `/signup` - P√°gina de assinatura em 2 etapas
- `/signup/success` - Confirma√ß√£o de assinatura com credenciais

### **Rotas Protegidas (Requer Autentica√ß√£o)**
- `/dashboard` - Dashboard personalizado por role e tenant
- `/profile` - Perfil do usu√°rio (placeholder)
- `/settings` - Configura√ß√µes (requer MANAGER ou ADMIN)
- `/admin` - √Årea administrativa (requer ADMIN)

### **Redirecionamentos Inteligentes**
```typescript
// Middleware atualizado com l√≥gica de redirecionamento
if (pathname === "/" && user) {
  return NextResponse.redirect(new URL("/dashboard", request.url));
}

// P√°gina inicial com verifica√ß√£o de autentica√ß√£o
useEffect(() => {
  if (!isLoading) {
    if (isAuthenticated) {
      router.push("/dashboard");
    } else {
      router.push("/login");
    }
  }
}, [isAuthenticated, isLoading, router]);
```

## üß™ Como Testar o Fluxo Completo

### **1. Fluxo de Assinatura**
```bash
# Acesse o admin app
http://localhost:3001

# Navegue pela assinatura
http://localhost:3001/signup

# Teste a p√°gina de sucesso
http://localhost:3001/signup/success?company=Teste&domain=teste-empresa
```

### **2. Fluxo de Login com Par√¢metros**
```bash
# Login com dados preenchidos
http://localhost:3001/login?email=admin@tech-solutions.com&tenant=tech-solutions

# Login normal
http://localhost:3001/login
```

### **3. Teste de Permiss√µes e Logout**
```bash
# Login como diferentes roles
1. admin@empresa-demo.com / Demo123!
2. manager@empresa-demo.com / Demo123!
3. agent@empresa-demo.com / Demo123!
4. viewer@empresa-demo.com / Demo123!

# Teste logout entre diferentes usu√°rios
1. Login ‚Üí Dashboard ‚Üí Logout ‚Üí Login com outro usu√°rio
```

## üìä Resumo das Melhorias

### ‚úÖ **Implementado Recentemente**
1. **P√°gina de assinatura completa** com sele√ß√£o de planos e valida√ß√£o
2. **P√°gina de sucesso** com credenciais tempor√°rias e pr√≥ximos passos
3. **Login aprimorado** com par√¢metros de URL e preenchimento autom√°tico
4. **Sistema de logout** com confirma√ß√£o e limpeza completa
5. **P√°gina inicial** de navega√ß√£o com op√ß√µes claras
6. **Middleware atualizado** com rotas p√∫blicas para assinatura
7. **Fluxo completo** de usu√°rio desde assinatura at√© dashboard

### üéØ **Experi√™ncia Completa**
- **Para novos clientes**: Assinatura ‚Üí Sucesso ‚Üí Login ‚Üí Dashboard
- **Para clientes existentes**: Login direto ‚Üí Dashboard
- **Para testes**: Credenciais demo organizadas ‚Üí Login ‚Üí Dashboard com permiss√µes
- **Para logout**: Confirma√ß√£o segura ‚Üí Limpeza ‚Üí Redirecionamento

### üîÑ **Fluxos Interconectados**
- Assinatura gera credenciais ‚Üí Login preenchido automaticamente
- Login com permiss√µes ‚Üí Dashboard personalizado
- Logout limpo ‚Üí Login novamente ‚Üí Teste outros usu√°rios
- Middleware protege rotas ‚Üí Redirecionamentos inteligentes

---

**ConnectHub: Plataforma SaaS Multi-Tenant completa, escal√°vel e pronta para produ√ß√£o! üöÄ‚ú®**

**Novo sistema implementado com fluxo completo de assinatura, login e logout funcionando perfeitamente!** üéâ